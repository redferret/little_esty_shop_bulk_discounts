<%= render partial: 'merchants/partials/navbar', locals: { merchant: @merchant }%>
<table class='table'>
  <thead>
    <tr>
      <th>Invoice #</th>
      <th>Status</th>
      <th>Creation Date</th>
      <th>Total Revenue</th>
      <th>Discounted Revenue</th>
      <th>Customer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><%= @invoice.id%></td>
      <td><%= @invoice.status%></td>
      <td><%= @invoice.created_at.strftime("%A, %B %-d, %Y")%></td>
      <td>$<%= @invoice.total_revenue%></td>
      <td>$<%= @invoice.discounted_revenue%></td>
      <td><%= @customer.first_name %> <%= @customer.last_name %></td>
    </tr>
  </tbody>
</table>
<br/>
<br/>
<h4>Items on this Invoice:</h4>
<table class="table text-justify">
  <thead>
    <tr>
      <th>Item Name</th>
      <th>Quantity</th>
      <th>Unit Price</th>
      <th>Bulk Discount</th>
      <th>Status</th>
    </tr>
  </thead>

  <tbody>
    <% @invoice.invoice_items.each do |i| %>
      <tr id="invoice-item-<%= i.id %>">
        <td><%= i.item.name %></td>
        <td><%= i.quantity %></td>
        <td>$<%= i.unit_price / 100 %></td>
        <td>
          <% id = @invoice.invoice_item_with_discount(i.id) %>
          <% if id %>
            <%= link_to 'Applied Discount', merchant_bulk_discount_url(@merchant.id, id), class:'btn btn-light btn-sm'%>
          <% end %>
        </td>
        <td><%= i.status %></td>
      </tr>
    <% end %>
  </tbody>
  <%= form_with model: @invoice, url: merchant_invoice_path(@merchant, @invoice), method: :patch, local: true do |f| %>
    <div class='form-group'>
      <%= f.select :status, Invoice.statuses.keys, selected: "#{@invoice.status}", class:'form-control' %>
    </div>
    <%= f.submit 'Update Invoice', class:'btn btn-primary btn-sm' %>
  <% end %>
</table>